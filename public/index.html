<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Snake</title>
        <style>
            * { padding: 0; margin: 0; }
            canvas { background: #eee; display: block; margin: 0 auto; }
        </style>
    </head>
    <body onload="draw()">
        <canvas id="myCanvas" width="500" height="500"></canvas>
        <!-- <script src="mainFunctions.js"></script> -->

        <script>
            var canvas = document.getElementById("myCanvas");
            var ctx = canvas.getContext("2d");

            var snakeHeight = 40;
            var snakeWidth = 40;
            var snakeX = (canvas.width - snakeWidth) / 2;
            var snakeY = (canvas.height - snakeHeight) / 2;
            var movementSpeed = 40;
            var snakeLength = 5;
            var count = 0;

            var snakeCubes = [0];
            snakeCubes[snakeLength] = {x:snakeX, y:snakeY};
            var foodHeight = 40;
            var foodWidth = 40;
            // var foodX = (Math.random()*(canvas.width- foodWidth)) + foodWidth;
            // var foodY = (Math.random()*(canvas.height - foodHeight)) + foodHeight;

            var foodX = Math.floor((Math.random() * (canvas.width - (foodWidth*2))) + foodWidth);
            var foodY = Math.floor((Math.random() * (canvas.height - (foodHeight*2))) + foodHeight);

            var foodX = Math.floor((Math.random() * 47) + 0)*10;
            var foodY = Math.floor((Math.random() * 47) + 0)*10;

            // foodX = 470;
            // foodY =470;

            var foodAte = false;

            var rightPressed = false;
            var leftPressed = false;
            var upPressed = false;
            var downPressed = false;


            var score = 0;
            var lives = 3;

            document.addEventListener("keydown", keyDownHandler, false);
            document.addEventListener("keyup", keyUpHandler, false);



            function keyDownHandler(e) {
                if (e.key == "Right" || e.key == "ArrowRight") {
                    rightPressed = true;
                }
                else if (e.key == "Left" || e.key == "ArrowLeft") {
                    leftPressed = true;
                }
                else if (e.key == "Up" || e.key == "ArrowUp") {
                    upPressed = true;
                }
                else if (e.key == "Down" || e.key == "ArrowDown") {
                    downPressed = true;
                }
                draw();
            }

            function keyUpHandler(e) {
                if (e.key == "Right" || e.key == "ArrowRight") {
                    rightPressed = false;
                }
                else if (e.key == "Left" || e.key == "ArrowLeft") {
                    leftPressed = false;
                }
                else if (e.key == "Up" || e.key == "ArrowUp") {
                    upPressed = false;
                }
                else if (e.key == "Down" || e.key == "ArrowDown") {
                    downPressed = false;
                }
            }


            function collisionDetection() {
                // snakeX > foodX && snakeX < foodX + foodWidth && snakeY > foodY && snakeY < foodY + foodHeight
                if (foodX == (snakeX) && foodY == (snakeY)) {
                    foodAte = true;
                    score++;
                    //alert("hit");
                    var foodX = Math.floor((Math.random() * (canvas.width - (foodWidth*2))) + foodWidth);
                    var foodY = Math.floor((Math.random() * (canvas.height - (foodHeight*2))) + foodHeight);

                    foodAte = false;
                    // if(score == brickRowCount*brickColumnCount) {
                    //     alert("YOU WIN, CONGRATULATIONS!");
                    //     document.location.reload();
                    //     // clearInterval(interval); // Needed for Chrome to end game
                    // }
                }
            }

            function drawFood() {
                ctx.beginPath();
                ctx.rect(foodX, foodY, snakeWidth, snakeHeight);
                ctx.fillStyle = "red";
                ctx.fill();
                ctx.closePath();
            }
            function drawSnake() {
                for(var c=0; c<snakeLength;c++){
                    var square = snakeCubes[1];
                    ctx.beginPath();
                    alert(snakeCubes[c].y);
                    ctx.rect(snakeCubes[c].x, snakeCubes[c].y, snakeWidth, snakeHeight);
                    //ctx.strokeStyle = "rgba(0, 0, 255, 0.5)";
                    ctx.fillStyle = "Green";
                    
                    ctx.fill();
                    ctx.closePath();
                    // var a = c *50;
                    // ctx.beginPath();
                    // ctx.rect(snakeX + a, snakeY + a, snakeWidth, snakeHeight);
                    // ctx.fillStyle = "Green";
                    // ctx.fill();
                    // ctx.closePath();
                }
                // ctx.beginPath();
                // ctx.rect(snakeX, snakeY, snakeWidth, snakeHeight);
                // ctx.fillStyle = "Green";
                // ctx.fill();
                // ctx.closePath();
            }
            function drawCoordinates(){
                ctx.font = "16px Arial";
                ctx.fillStyle = "#0095DD";
                ctx.fillText("Snake -> X: "+snakeX + " Y: " + snakeY, 8, 50);
                ctx.fillText("Food -> X: "+ foodX + " Y: "+ foodY, 8, 80);
            }

            function drawScore() {
                ctx.font = "16px Arial";
                ctx.fillStyle = "#0095DD";
                ctx.fillText("Score: "+score, 8, 20);
            }

            function drawLives() {
                ctx.font = "16px Arial";
                ctx.fillStyle = "#0095DD";
                ctx.fillText("Lives: "+lives, canvas.width-65, 20);
            }

            function draw() {
                count++;
                if(count >= snakeLength){
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    count = 0;
                }
                if(foodAte == false){
                    drawFood();
                }
                drawSnake();
                drawScore();
                drawLives();
                collisionDetection();

                drawCoordinates();

                if (rightPressed && snakeX < canvas.width - snakeWidth) {
                    snakeX += movementSpeed;
                    snakeCubes.push({x:snakeX,y:snakeY})
                    snakeCubes.pop();
                }
                else if (leftPressed && snakeX > 0) {
                    snakeX -= movementSpeed;
                    snakeCubes.push({x:snakeX,y:snakeY})
                    snakeCubes.pop();
                }
                if (upPressed && snakeY > 0) {
                    snakeY -= movementSpeed;
                    snakeCubes.push({x:snakeX,y:snakeY})
                    snakeCubes.pop();
                }
                if (downPressed && snakeY < canvas.height - snakeHeight) {
                    snakeY += movementSpeed;
                    snakeCubes.push({x:snakeX,y:snakeY})
                    snakeCubes.pop();
                }




                
                
                //requestAnimationFrame(draw);
            }

            //var interval = setInterval(draw, 100);
            // draw();
        </script>
    </body>
</html>